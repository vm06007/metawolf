#!/usr/bin/env node
/**
 * Generate gas station config from .env file
 * This runs at build time to inject the private key
 */

import { readFileSync, writeFileSync } from 'fs';
import { join } from 'path';

function loadEnv() {
    try {
        const envPath = join(process.cwd(), '.env');
        const envContent = readFileSync(envPath, 'utf-8');
        const envVars = {};
        
        envContent.split('\n').forEach(line => {
            line = line.trim();
            if (line && !line.startsWith('#')) {
                const [key, ...valueParts] = line.split('=');
                if (key && valueParts.length > 0) {
                    const value = valueParts.join('=').trim();
                    // Remove quotes if present
                    const cleanValue = value.replace(/^["']|["']$/g, '');
                    envVars[key.trim()] = cleanValue;
                }
            }
        });
        
        return envVars;
    } catch (error) {
        console.warn('[generate-gas-station-config] Could not load .env file:', error.message);
        return {};
    }
}

const envVars = loadEnv();
const privateKey = envVars.GAS_STATION_PRIVATE_KEY || '';

// Generate config file
const configContent = `/**
 * Gas Station Config - Auto-generated from .env file
 * DO NOT EDIT THIS FILE - It is generated during build
 */

export const GAS_STATION_PRIVATE_KEY = ${privateKey ? `'${privateKey}'` : 'null'};
`;

const configPath = join(process.cwd(), 'src/core/gas-station-config.ts');
writeFileSync(configPath, configContent, 'utf-8');

console.log('[generate-gas-station-config] Generated config file:', configPath);
if (!privateKey) {
    console.warn('[generate-gas-station-config] WARNING: GAS_STATION_PRIVATE_KEY not found in .env file');
}

